var photos=[],thumbs=[],images=[],count_photos=0,count_updates=0,idx=0;function cwf_init(a){photos=a;count_photos=photos.length;cwf_init_layout();cwf_init_shortcuts();for(a=0;a<count_photos;a++){thumbs.push(photos[a][6]);images.push(photos[a][7])}$.backstretch(thumbs[0]);$({}).imageLoader({images:thumbs,async:true});$({}).imageLoader({images:[images.shift()],async:false,complete:function(){cwf_show_photo(idx)}});a=parseInt(new Date/1E3);cwf_schedule_check_photos(a)}
function cwf_init_subscription(){var a=function(b){b=JSON.parse(b);b=b.photos;var e=b.length;if(e){for(var d=[],c=0;c<e;c++){var f=b[c];d.push([f.photo_id,f.title,f.owner,f.ownername,f.faved_by_nsid,f.faved_by,f.thumb_url,f.display_url])}cwf_init(d)}else{b=new Date;b=String(b);b="Last checked at "+b+", still nothing yet.";$("#last_check").html(b);cwf_init_subscription(6E4)}};setTimeout(function(){$.ajax({url:"/api",data:{method:"flickr.photos.friends.faves"},success:a})},6E4)}
function cwf_init_layout(){$("#content").hide();$("#main").css("background-color","transparent");$("#footer").css("opacity",".75");$("#main").append('<div id="cwf_about"></div>')}
function cwf_init_shortcuts(){var a=function(){cwf_show_previous_photo("overflow")},b=function(){cwf_show_next_photo("overflow")},e=function(){cwf_show_photo(0)},d=function(){cwf_show_photo(photos.length-1)};$(document).keydown(function(c){if(c.keyCode==37)a();else if(c.keyCode==38)e();else if(c.keyCode==39)b();else c.keyCode==40&&d()});$(document).touchwipe({wipeLeft:b,wipeRight:a,wipeUp:e,wipeDown:d,min_move_x:20,min_move_y:20,preventDefaultEvents:true})}
function cwf_schedule_check_photos(a){setTimeout(function(){$.ajax({url:"/api",data:{method:"flickr.photos.friends.faves",older_than:a},success:cwf_check_photos_callback,error:function(b){console.log(b);cwf_schedule_check_photos(a)}})},6E4)}function cwf_check_photos_callback(a){try{_cwf_check_photos_callback(a)}catch(b){console.log(b);console.log(a)}last_check=parseInt(new Date/1E3);cwf_schedule_check_photos(last_check)}
function _cwf_check_photos_callback(a){a=JSON.parse(a);a=a.photos;var b=a.length;if(b){a.reverse();for(var e=[],d=0;d<b;d++){var c=a[d];e.push(c.display_url);e.push(c.thumb_url);photos.unshift([c.photo_id,c.title,c.owner,c.ownername,c.faved_by_nsid,c.faved_by,c.thumb_url,c.display_url])}$({}).imageLoader({images:e,async:true});idx+=b;count_updates+=b;a='<a href="#" onclick="cwf_show_photo(0);return false;">';a+=count_updates>1?"there are "+count_updates+" new faves":"there are new faves";a+="</a>";
$("#cwf_updates").html(a);$("#cwf_photo_idx").html(idx+1);$("#cwf_count_photos").html(photos.length)}}function cwf_next_photo(a){if(a)return idx<photos.length-1?idx+1:0;return idx<photos.length-1?idx+1:-1}function cwf_previous_photo(a){if(a)return idx>0?idx-1:count_photos-1;return idx>0?idx-1:-1}function cwf_show_previous_photo(a){a=cwf_previous_photo(a);cwf_show_photo(a)}function cwf_show_next_photo(a){a=cwf_next_photo(a);cwf_show_photo(a)}
function cwf_show_photo(a){count_updates=0;idx=a;for(var b=[],e=0;e<2;e++){if(!images.length)break;b.push(images.shift());b.push(images.unshift())}b.length&&$({}).imageLoader({images:b,async:true});var d=photos[a];b=d[0];e=d[1];var c=d[2],f=d[3],g=d[4],h=d[5],i=d[6];d=d[7];a=a+1;e=e+", by "+f;msg='<a href="http://www.flickr.com/photos/'+c+"/"+b+'/" target="_flickr" title="'+e+'">';msg+='<img src="'+d+'" /></a><br >';msg+='<div id="cwf_about_text">';msg+='<a href="http://www.flickr.com/photos/'+g+
'/faves/" target="_flickr">'+h+"</a>";msg+=' <span style="font-size:1.2em;font-weight:700;">\u2606</span>  ';msg+='<a href="http://www.flickr.com/photos/'+c+'/" target="_flickr">'+f+"</a><br />";msg+='no. <span id="cwf_photo_idx">'+a+'</span> of <span id="cwf_count_photos">'+photos.length+"</span> faves";if(a>1)msg+=' / <a href="#" onclick="cwf_show_next_photo();return false;" title="before, keyboard shortcut: \u21e6">before</a>';if(a<count_photos)msg+=' / <a href="#" onclick="cwf_show_previous_photo();return false;" title="after, keyboard short: \u21e8">after</a>';
msg+='<div id="cwf_updates"></div>';msg+="</div>";$("#cwf_about").html("");$.backstretch(i);$("#cwf_about").html(msg)};
